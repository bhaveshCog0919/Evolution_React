{"ast":null,"code":"'use strict';\n\nconst crypto = require('crypto');\n\nconst Transform = require('stream').Transform;\n\nclass StreamHash extends Transform {\n  constructor(attachment, algo) {\n    super();\n    this.attachment = attachment;\n    this.algo = (algo || 'md5').toLowerCase();\n    this.hash = crypto.createHash(algo);\n    this.byteCount = 0;\n  }\n\n  _transform(chunk, encoding, done) {\n    this.hash.update(chunk);\n    this.byteCount += chunk.length;\n    done(null, chunk);\n  }\n\n  _flush(done) {\n    this.attachment.checksum = this.hash.digest('hex');\n    this.attachment.size = this.byteCount;\n    done();\n  }\n\n}\n\nmodule.exports = StreamHash;","map":null,"metadata":{},"sourceType":"script"}